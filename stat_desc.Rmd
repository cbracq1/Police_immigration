---
title: "Premières statistiques descriptives"
author: "Bracq, Raymond"
date: "28/11/2023"
output:
  html_notebook: 
    encoding: UTF-8
  pdf_document: default
  html_document:
    df_print: paged
    encoding: UTF-8
editor_options:
  markdown:
    wrap: 72
---

# Projet DSSS : Police et immigration {.tabset .tabset-fade}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include = FALSE}
library(haven)#si t'as pas les packages il faut faire install.packages("nom du package") dans la console
library(tidyverse)
library(dplyr)
library(labelled)
library(survey)
library(arrow)
library(ggplot2)
library(questionr)
library(corrplot)
```

```{r base, include = FALSE}
source("Base.R")
```

```{r}

#Population immigrée
indiv_immig = indiv_pd[which(indiv_pd$variables$group1_code=="G1_I")]

#Population descendante d'immigrées
indiv_desce = indiv_pd[which(indiv_pd$variables$group1_code=="G2_I")]


#Population né en France métropolitaine
indiv_metro = indiv_pd[which(indiv_pd$variables$group1_code=="Autre")]



```


## Caractérisation de la confiance en la police


### a) Qui a confiance en la police

```{r}

# Etre immigré

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+group1_code, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")
```

Nous constatons que les immigrés ont une confiance plus élevé en la police que les natifs de France métropolitaine. Ce qui est le point de départ de notre étude.

```{r}

# Genre (pop = metro)


tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+sexee, indiv_metro[which(indiv_metro$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = sexee, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity") + ggtitle("Genre et métro")

# Genre (pop = immigré)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+sexee, indiv_immig[which(indiv_immig$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = sexee, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity") + ggtitle("Genre et immigré")

# Genre (pop = descendants)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+sexee, indiv_desce[which(indiv_desce$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = sexee, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity") + ggtitle("Genre et descendants")

```
Le genre féminin semble a priori avoir plus confiance en la police mais ce n'est rien de violent.


```{r}

# Revenu par unité de consommation du ménage (en €)



limit = 200


coloration = c("red","orange","green")
group_un = c("G1_I","G2_I","Autre")

dfinal = data.frame(X=(1:40)*100)

for (i in 1:3){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g,uc_reve_isna==FALSE)

  
  X = (1:40)*100
  Y = c()
  for (x in X){
    datax = filter(data,uc_reve > x & uc_reve < x+100 & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol_rec == "Tout à fait confiance en la police")
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    
    
    if (n_tot == 0){
      Y = c(Y,NA)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(g,"_","Y",sep="")] = Y
  
  
}


dfinal["Revenus"]=dfinal["X"]
dfinal["Proportion_de_confiants_en_la_police"]=dfinal["G1_I_Y"]


ggplot(dfinal,aes(x =Revenus))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_point(aes(y=Autre_Y),color="green", alpha = 0.5)+
  geom_point(aes(y = G2_I_Y),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = G1_I_Y),color="red")+
  geom_smooth(aes(y = G2_I_Y),color="orange")+
  geom_smooth(aes(y=Autre_Y),color="green")+
  ggtitle("Confiance en la police selon les revenus")
```

Les revenus ne semblent pas avoir d'importance pour les métropolitains concernant leur confiance envers la police. 

Cela est aussi vrai pour immigrés et descendants JUSQU'A 2500€ où là les hauts revenus ont significativement plus confiance en la police chez les immigrés et significativement moins confiance en la police chez les descendants. C'est tranche là ne touche néanmoins que 5% de la population (supérieur à 3500€ de revenus par unité de consommation).

Cela nous permet d'observer qu'à partir d'un certain niveau de revenus, une personne immigré cesse de craidre la police de part son meilleur statut financier. Evidemment d'autres variables peuvent être à l'origine de cette corrélation.

```{r}

# Age


limit = 60

coloration = c("red","orange","green")
group_un = c("G1_I","G2_I","Autre")

dfinal = data.frame(X=1:limit)

for (i in 1:3){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g)
  
  X = 1:limit
  Y = c()
  for (x in X){
    datax = filter(data,agenq==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol_rec == "Tout à fait confiance en la police")
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,NA)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(g,"_","Y",sep="")] = Y
  
  
}


dfinal["Age"]=dfinal["X"]
dfinal["Proportion_de_confiants_en_la_police"]=dfinal["G1_I_Y"]


ggplot(dfinal,aes(x =Age))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_point(aes(y=Autre_Y),color="green", alpha = 0.5)+
  geom_point(aes(y = G2_I_Y),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = G1_I_Y),color="red")+
  geom_smooth(aes(y = G2_I_Y),color="orange")+
  geom_smooth(aes(y=Autre_Y),color="green")+
  ggtitle("Confiance en la police selon l'âge de l'individu")
```

Pour les immigrés, l'âge semble être un facteur déterminant dans la confiance en la police. En particulier entre 18 et 45 ans, les deux variables sont positivement corrélées puis au-delà elles deviennent négativement corrélées.

Concernant les descendants, l'âge et légèrement positivement corrélé avec la confiance en la police, ce qui rejoint l'hypothèse d'une confrontation du jeune avec la police.

Enfin pour les métropolitains, l'âge semble indépendant de la confiance en la police.


```{r}

# Age et sexe


limit = 60


group_un = c("G1_I","G2_I","Autre")

g_sexee = unique(indiv$sexee_rec)

dfinal = data.frame(X=1:limit)

for (i in 1:2){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[1]
  
  sex = g_sexee[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g,sexee_rec==sex)
  
  X = 1:limit
  Y = c()
  for (x in X){
    datax = filter(data,agenq==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol_rec == "Tout à fait confiance en la police")
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,NA)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(sex,sep="")] = Y
  
  
}


dfinal["Age"]=dfinal["X"]
dfinal["Proportion_de_confiants_en_la_police"]=dfinal["Feminin"]


ggplot(dfinal,aes(x =Age))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_point(aes(y = Masculin),color="blue", alpha = 0.5)+
  geom_smooth(aes(y = Feminin),color="red")+
  geom_smooth(aes(y = Masculin),color="blue")+
  ggtitle("Confiance en la police selon l'âge et le sexe de l'individu")
```

```{r}

# Age et interpellation


limit = 60

coloration = c("red","orange","green")
group_un = c("G1_I","G2_I","Autre")

g_contri = c("Jamais","Une seule fois","De 2 à 5 fois","Plus de 5 fois")

dfinal = data.frame(X=1:limit)

for (i in 1:4){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[1]
  co = g_contri[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g)
  
  X = 1:limit
  Y = c()
  for (x in X){
    datax = filter(data,agenq==x & data$i_contri_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_contri_rec == co)
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,NA)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(co,sep="")] = Y
  
  
}


dfinal["Age"]=dfinal["X"]
dfinal["Proportion_de_chaque_fréquence_de_contrôle"]=dfinal["Jamais"]
dfinal["Une_seule_fois"]=dfinal["Une seule fois"]
dfinal["De_2_à_5_fois"]=dfinal["De 2 à 5 fois"]
dfinal["Plus_de_5_fois"]=dfinal["Plus de 5 fois"]


ggplot(dfinal,aes(x =Age))+
  geom_point(aes(y = Proportion_de_chaque_fréquence_de_contrôle),color="blue", alpha = 0.5)+
  geom_point(aes(y = Plus_de_5_fois),color="red", alpha = 0.5)+
  geom_point(aes(y=Une_seule_fois),color="green", alpha = 0.5)+
  geom_point(aes(y = De_2_à_5_fois),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = Plus_de_5_fois),color="red")+
  geom_smooth(aes(y = De_2_à_5_fois),color="orange")+
  geom_smooth(aes(y=Une_seule_fois),color="green")+
  geom_smooth(aes(y=Proportion_de_chaque_fréquence_de_contrôle),color="blue")+
  ggtitle("Fréquence des contrôles selon l'âge")
```
Nous constatons que le nombre d'interpellations décroit avec l'âge : ce sont surtout les jeunes de 20 à 35 ans qui sont contrôlés par la police.


```{r}

# Durée de vie en France

limit = 50

coloration = c("red","orange","green")
group_un = c("G1_I","G2_I","Autre")

dfinal = data.frame(X=1:limit)

for (i in 1:3){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g)
  
  X = 1:50
  Y = c()
  for (x in X){
    datax = filter(data,durar2==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol_rec == "Tout à fait confiance en la police")
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,0)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(g,"_","Y",sep="")] = Y
  
  #df = data.frame(X=1:limit,Y=Y,group=g)
  #dfinal = rbind(dfinal,df)  
  
}


dfinal["Durée_de_séjour_en_France"]=dfinal["X"]
dfinal["Proportion_de_confiants_en_la_police"]=dfinal["G1_I_Y"]


ggplot(dfinal,aes(x =Durée_de_séjour_en_France))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_point(aes(y=Autre_Y),color="green", alpha = 0.5)+
  geom_point(aes(y = G2_I_Y),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = G1_I_Y),color="red")+
  geom_smooth(aes(y = G2_I_Y),color="orange")+
  geom_smooth(aes(y=Autre_Y),color="green")+
  ggtitle("Confiance en la police selon la durée de séjour en France")
```

Nous observons pour les immigrés que la confiance en la police réduit avec la durée de séjour en France. Cette observation viendrait confirmer l'hypothèse du "leap of faith". En passant du temps dans le pays, et notamment en intéragissant avec sa police, nous idéalisons moins les institutions du pays d'accueil.


```{r}
limit = 60

coloration = c("red","orange","green","blue")

age_groupe = c("18_29","30_39","40_49","50_59")

l_age_inf = c(18,30,40,50)
l_age_sup = c(29,39,49,59)

df = data.frame(X =X)

for (i in 1:4){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  age_inf = l_age_inf[i]
  age_sup = l_age_sup[i]
  age_g = age_groupe[i]
  
  g = group_un[1]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g & indiv$agenq >= age_inf & indiv$agenq <= age_sup)
  
  X = 1:limit
  Y = c()
  stopp = limit
  for (x in X){
    datax = filter(data,durar2==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol < 2)
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,NA)
      stopp = min(stopp,x)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  
  df[paste("Y_",age_g,sep="")] = Y
  

}

df["Durée_de_séjour_en_France"]=df["X"]
df["Proportion_de_confiants_en_la_police"]=df["Y_18_29"]



ggplot(df,aes(x =Durée_de_séjour_en_France))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_smooth(aes(y = Proportion_de_confiants_en_la_police),color="red")+
  geom_point(aes(y = Y_30_39),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = Y_30_39),color="orange")+
    geom_point(aes(y = Y_40_49),color="green", alpha = 0.5)+
  geom_smooth(aes(y = Y_40_49),color="green")+
    geom_point(aes(y = Y_50_59),color="blue", alpha = 0.5)+
  geom_smooth(aes(y = Y_50_59),color="blue")+
  ggtitle("Confiance en la police selon la durée de séjour en France et l'âge")
```

Cette observation persiste lorsque nous réalisons cette même observation pour différentes tranches d'âges. La durée de séjour ne serait donc pas qu'un proxy de l'effet de l'âge dans l'explication en la police mais serait une composante déterminante en soi.

```{r}

# Origine (pop = Immigré)

# QPV (pop = Ensemble)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+origine_tous_g2_code, indiv_immig[which(indiv_immig$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = origine_tous_g2_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~origine_tous_g2_code+taux_confiance, indiv_immig[which(indiv_immig$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,origine_tous_g2_code != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = origine_tous_g2_code)) +
  geom_bar(stat="identity")


```


Nous remarquons que parmi les personnes qui n'ont pas confiance en la police il y a :
- plus d'Algérien
- plus de guinéen
- plus de sahélien

- moins de Marocain/Tunisien
- moins d'Européen hors-UE



```{r}

# Origine (pop = Descendants)

# QPV (pop = Ensemble)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+origine_tous_g2_code, indiv_desce[which(indiv_desce$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = origine_tous_g2_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~origine_tous_g2_code+taux_confiance, indiv_desce[which(indiv_desce$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,origine_tous_g2_code != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = origine_tous_g2_code)) +
  geom_bar(stat="identity")


```
Nous remarquons que parmis les personnes qui n'ont pas confiance en la police il y a :
- moins d'Asiatique
- moins de Portugais
- moins d'Espagnol/Italien
- moins de Union Européen
- moins d'européen hors UE
- moins d'Asie du Sud-Est

- plus d'Algérien
- plus de Guinéen
- plus de sahélien
- plus de Marocain/Tunisien

```{r}

# QPV (pop = Ensemble)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+qpv_i_rec, indiv_pd[which(indiv_pd$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~qpv_i_rec+taux_confiance, indiv_pd[which(indiv_pd$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,qpv_i_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = qpv_i_rec)) +
  geom_bar(stat="identity")

```

Il y a une surreprésentation des personnes vivant en qpv parmis les personnes n'ayant PAS confiance en la police. Symétriquement, vivre en QPV prédispose à ne pas avoir confiance en la police. Pourtant, parmi les personnes qui ont confiance et qui vivent en qpv : il y a une plus grande confiance. Nous constatons très certainement dans les QPV la présence des immigrés et de leur descendants. Le fait de vivre en QPV n'a donc a priori pas d'influence clair sur la confiance en la police indépendamment des populations qui s'y trouvent.

```{r}

# QPV (pop = métro)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+qpv_i_rec, indiv_metro[which(indiv_metro$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~qpv_i_rec+taux_confiance, indiv_metro[which(indiv_metro$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,qpv_i_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = qpv_i_rec)) +
  geom_bar(stat="identity")

```
Même observation chez les métropolitains.

```{r}

# QPV (pop = immigré)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+qpv_i_rec, indiv_immig[which(indiv_immig$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~qpv_i_rec+taux_confiance, indiv_immig[which(indiv_immig$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,qpv_i_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = qpv_i_rec)) +
  geom_bar(stat="identity")

```
Nous observons sur les populations uniquement immigrés le même phénomène mais de façon plus marginale.


```{r}

# QPV (pop = descendants)
tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+qpv_i_rec, indiv_desce[which(indiv_desce$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~qpv_i_rec+taux_confiance, indiv_desce[which(indiv_desce$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,qpv_i_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = qpv_i_rec)) +
  geom_bar(stat="identity")

```
Il y a enfin une très forte prévalence à ne pas avoir confiance en la police lorsque nous vivons en QPV parmi les descendants. Ici le fait de vivre en QPV est donc un fort facteur sur l'explication de la conifance envers la police.

###b) Relation au sein du quartier

```{r}

# Présence d'immigré dans le quartier (pop = metro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_immi_rec, indiv_metro[which(indiv_metro$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_immi_rec+taux_confiance, indiv_metro[which(indiv_metro$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")


```

C'est encore moins clair.

```{r}

# Présence d'immigré dans le quartier (pop = immigré)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_immi_rec, indiv_immig[which(indiv_immig$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_immi_rec+taux_confiance, indiv_immig[which(indiv_immig$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")


```
Même observation que pour les descendants mais en moins flagrant.


```{r}

# Présence d'immigré dans le quartier (pop = descendant)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_immi_rec, indiv_desce[which(indiv_desce$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_immi_rec+taux_confiance, indiv_desce[which(indiv_desce$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")

```

Nous constatons chez les descendants que la présence d'immigrés dans le quartier de résidence et confiance en la police sont négativement corrélé : au plus il y a d'immigré dans son quartier, au moins nous avons confiance en la police lorsque nous descendons d'immigré. Nous nous doutons que cela s'explique par le fait qu'un quartier ayant une plus forte présence d'immigré serait aussi plus de fois fréquenté par la police. L'intéraction avec la police serait alors à l'origine dans la regression avec la confiance. C'est ce que nous verifierons tout à l'heure.

```{r}

# Relation entre part d'immigré dans le quartier et nombre de controle (pop = metropolitain)

tb1 <- data.frame(cprop(svytable(~l_immi_rec+i_contri_rec, indiv_metro[which(indiv_metro$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")


# Relation entre part d'immigré dans le quartier et nombre de controle (pop = immigrés)

tb1 <- data.frame(cprop(svytable(~l_immi_rec+i_contri_rec, indiv_immig[which(indiv_immig$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")


# Relation entre part d'immigré dans le quartier et nombre de controle (pop = descendants)

tb1 <- data.frame(cprop(svytable(~l_immi_rec+i_contri_rec, indiv_desce[which(indiv_desce$variables$l_immi_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_immi_rec)) +
  geom_bar(stat="identity")


```

Ca semble correspondre mais c'est alors la troisième partie qui nous interessera.


```{r}

# Sentiment de sécurité dans le quartier (pop = metro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_quart_secu_rec, indiv_metro[which(indiv_metro$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_quart_secu_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+taux_confiance, indiv_metro[which(indiv_metro$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


```
Parmi les populations nées en France métropolitaine, nous accordons moins de confiance à la police que nous ne nous sentons moins en sécurité dans notre quartier. Ainsi, nous pourrions accorder notre sentiment de sécurité selon la confiance que l'on accorde à la police : si nous avons confiance en la police alors elle sera là pour nous protéger, nous nous sentons en sécurité et inversement. Ou alors c'est parce que la police assure notre sécurité que nous avons confiance.

Se serez donc soit une défaillance de la police soit un manque de foi en notre quartier que nous interprétons comme une défaillance de la police (nous ne pensons pas quelle soit capable d'assurer notre sécurité alors même que nous nous sentons en danger) qui nous conduirez à ne pas avoir confiance en elle.


```{r}

# Sentiment de sécurité dans le quartier (pop = immigré)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_quart_secu_rec, indiv_immig[which(indiv_immig$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_quart_secu_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+taux_confiance, indiv_immig[which(indiv_immig$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")

```
Parmi les immigrés, nous remarquons seulement que les personnes qui n'ont pas confiance en la police ne se sentent pas en sécurité dans leur quartier. Ce serait donc la police qui serait à l'origine de la confiance que nous pouvons avoir dans notre quartier. Surement en proxy de la présence policière.


```{r}

# Sentiment de sécurité dans le quartier (pop = descendants)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_quart_secu_rec, indiv_desce[which(indiv_desce$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_quart_secu_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+taux_confiance, indiv_desce[which(indiv_desce$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")

```
Nous retrouvons chez les descendants une forte corrélation entre sécurité du quartier en confiance en la police : la police serait à l'origine de cette insécurité par présence ou incompétence. Nous confirmerons avec la troisième partie ces hypothèses.


```{r}

# Relation entre sécurité dans le quartier et nombre de controle (pop = metropolitain)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+i_contri_rec, indiv_metro[which(indiv_metro$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


# Relation entre sécurité dans le quartier et nombre de controle (pop = immigrés)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+i_contri_rec, indiv_immig[which(indiv_immig$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


# Relation entre sécurité dans le quartier et nombre de controle (pop = descendants)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+i_contri_rec, indiv_desce[which(indiv_desce$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


```
```{r}

# Relation entre sécurité et présence d'immigrés dans le quartier  (pop = metropolitain)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+l_immi_rec, indiv_metro[which(indiv_metro$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


# Relation entre sécurité et présence d'immigrés dans le quartier  (pop = immigrés)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+l_immi_rec, indiv_immig[which(indiv_immig$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


# Relation entre sécurité et présence d'immigrés dans le quartier  (pop = descendants)

tb1 <- data.frame(cprop(svytable(~l_quart_secu_rec+l_immi_rec, indiv_desce[which(indiv_desce$variables$l_quart_secu_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_quart_secu_rec != "Total")

ggplot(tb2, aes(x = l_immi_rec, y= Freq, fill = l_quart_secu_rec)) +
  geom_bar(stat="identity")


```

```{r}
#Matrice de correlation i_contri x l_immi x rquart_secu x i_cnfpol

dmat = data.frame(indiv_pd$variables$i_cnfpol,indiv_pd$variables$i_contri,indiv_pd$variables$l_immi,indiv_pd$variables$l_quart_secu)

dmat["Confiance en la police"]=dmat$indiv_pd.variables.i_cnfpol
dmat["Présence d'immigrés"] = dmat$indiv_pd.variables.l_immi
dmat["Sécurité dans le quartier"]=dmat$indiv_pd.variables.l_quart_secu

dmat <- dmat %>% 
  mutate(Fréquence_des_Contrôles = 
           case_when(indiv_pd.variables.i_contri == 1 ~ 4,
                     indiv_pd.variables.i_contri == 2 ~ 3,
                     indiv_pd.variables.i_contri == 3 ~ 2,
                     indiv_pd.variables.i_contri == 4 ~ 1))
  
dmat["Fréquence des contrôles"] = dmat$Fréquence_des_Contrôles

dmat <- dmat %>% select(c("Confiance en la police","Fréquence des contrôles","Sécurité dans le quartier","Présence d'immigrés"))

install.packages("ggcorrplot")
library(ggcorrplot)
corrplot(cor(dmat),method="number")
```



```{r}

# Part de ses amis au sein du quartier (pop = metro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+a_rquart_code, indiv_metro[which(indiv_metro$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = a_rquart_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~a_rquart_code+taux_confiance, indiv_metro[which(indiv_metro$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,a_rquart_code != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = a_rquart_code)) +
  geom_bar(stat="identity")

```

Il ne semble pas qu'il n'y pas ait de relation entre confiance en la police et la part de ses amis dans le quartier de résidence.

```{r}

# Part de ses amis au sein du quartier (pop = immigré)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+a_rquart_code, indiv_immig[which(indiv_immig$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = a_rquart_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~a_rquart_code+taux_confiance, indiv_immig[which(indiv_immig$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,a_rquart_code != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = a_rquart_code)) +
  geom_bar(stat="identity")

```
Pas de relation.

```{r}

# Part de ses amis au sein du quartier (pop = descendant)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+a_rquart_code, indiv_desce[which(indiv_desce$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = a_rquart_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~a_rquart_code+taux_confiance, indiv_desce[which(indiv_desce$variables$a_rquart_code != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,a_rquart_code != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = a_rquart_code)) +
  geom_bar(stat="identity")

```
Pas de relation.


###c) Relation avec la police et autres

```{r}

# Fréquence des contrôles de police (pop = métro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+i_contri_rec, indiv_metro[which(indiv_metro$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+taux_confiance, indiv_metro[which(indiv_metro$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")

```

Nous remarquons que les trois populations perdent confiance en la police lorsqu'ils sont souvent controlés ET que les personnes qui sont le plus controlé sont aussi celle qui ont le moins confiance en la police. Ces indications nous semble dire que c'est la présence policière qui mènent à un sentiment d'insécurité et non son inefficacité pour la réguler. C'est la police qui est perçue comme danger lorsque nous la cotoyons fréquemment. Une dernière comparaison entre fréquence des controles et part d'immigré nous permettra détailler cette hypothèse.


```{r}

# Fréquence des contrôles de police (pop = immigré)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+i_contri_rec, indiv_immig[which(indiv_immig$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+taux_confiance, indiv_immig[which(indiv_immig$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")

```
Idem

```{r}

# Fréquence des contrôles de police (pop = descendant)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+i_contri_rec, indiv_desce[which(indiv_desce$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+taux_confiance, indiv_desce[which(indiv_desce$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")

```
Idem

```{r}

# Fréquence des contrôles de police x Part d'immigrés dans le quartier

tb1 <- data.frame(cprop(svytable(~l_immi_code+i_contri_rec, indiv_metro[which(indiv_metro$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,l_immi_code != "Total")

ggplot(tb2, aes(x = i_contri_rec, y= Freq, fill = l_immi_code)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+l_immi_code, indiv_metro[which(indiv_metro$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = l_immi_code, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")


```
Métro : Nous remarquons que la présence d'immigré favorise les chances d'être controlé au moins une fois.

Immigrés : Pareil mais moins flagrant que Descendants

Descendants : Nous constatons qu'il existe une légère prépondérance aux controles fréquent lorsqu'il y a une plus grande présence d'immigrés. En revanche, la part des individus ayant été controlé plus de 5 fois ont significativement plus d'immigré dans leur quartier.


Il existerai donc bien une surrencontre policière lié à la surprésence d'immirgé dans son quartier, certainement dû à une surprésence même de la police dans ces quartiers.


### d) Face à la discrimination

```{r}

# Discrimination par le comportement policier (pop = metro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+compor_discri, indiv_metro[which(indiv_metro$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = compor_discri, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~compor_discri+taux_confiance, indiv_metro[which(indiv_metro$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,compor_discri != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = compor_discri)) +
  geom_bar(stat="identity")

```
```{r}

# Discrimination par le comportement policier (pop = immigré)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+compor_discri, indiv_immig[which(indiv_immig$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = compor_discri, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~compor_discri+taux_confiance, indiv_immig[which(indiv_immig$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,compor_discri != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = compor_discri)) +
  geom_bar(stat="identity")

```
```{r}

# Discrimination par le comportement policier

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+compor_discri, indiv_desce[which(indiv_desce$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = compor_discri, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~compor_discri+taux_confiance, indiv_desce[which(indiv_desce$variables$compor_discri != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,compor_discri != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = compor_discri)) +
  geom_bar(stat="identity")

```
Bon ben la discrimination dans le comportement policier réduit la confiance...

```{r}

# Discrimination policiere ou non (pop = metro)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+d_lieudisagr_d_rec, indiv_metro[which(indiv_metro$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = d_lieudisagr_d_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~d_lieudisagr_d_rec+taux_confiance, indiv_metro[which(indiv_metro$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,d_lieudisagr_d_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = d_lieudisagr_d_rec)) +
  geom_bar(stat="identity")

```
Nous remarquons dans la population métropolitaine que le fait de subir une discrimination par la police caractérise massivement le manque de confiance en elle. Le fait d'avoir subi des discriminations dans d'autres cadres favorisent légèrement cette tendance également.

```{r}

# Discrimination policiere ou non (pop = immigrés)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+d_lieudisagr_d_rec, indiv_immig[which(indiv_immig$variables$i_cnfpol_rec  != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = d_lieudisagr_d_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~d_lieudisagr_d_rec+taux_confiance, indiv_immig[which(indiv_immig$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,d_lieudisagr_d_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = d_lieudisagr_d_rec)) +
  geom_bar(stat="identity")

```
Idem

```{r}

# Discrimination policiere ou non (pop = descendants)

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+d_lieudisagr_d_rec, indiv_desce[which(indiv_desce$variables$i_cnfpol_rec  != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = d_lieudisagr_d_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~d_lieudisagr_d_rec+taux_confiance, indiv_desce[which(indiv_desce$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,d_lieudisagr_d_rec != "Total")

ggplot(tb2, aes(x = taux_confiance, y= Freq, fill = d_lieudisagr_d_rec)) +
  geom_bar(stat="identity")

```
Idem

```{r}

# Qui subit le plus les discriminations ?

tb1 <- data.frame(cprop(svytable(~group1_code+d_lieudisagr_d_rec, indiv_pd[which(indiv_pd$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,group1_code != "Total")

ggplot(tb2, aes(x = d_lieudisagr_d_rec, y= Freq, fill = group1_code)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~d_lieudisagr_d_rec+group1_code, indiv_pd[which(indiv_pd$variables$d_lieudisagr_d_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,d_lieudisagr_d_rec != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = d_lieudisagr_d_rec)) +
  geom_bar(stat="identity")

```


## Confiance en la police

La variable d'intérêt est i_cnfpol : Avez-vous confiance dans les
institutions suivantes en France : la police

```{r, echo = FALSE}
stable <- svytable(~i_cnfpol_rec + group1_rec, indiv_pd)
```

```{r}
ggsurvey(indiv_pd, aes(x = as.factor(group1_code), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
  geom_bar(stat = "identity")

#ggsurvey(indiv_pd, aes(x = as.factor(group1_rec), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
#  geom_bar(stat = "identity")


```

Graphique relatif de la confiance envers la police :

```{r}
#Si il faut faire une repondération :


tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+group1_code, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")
```

La durée de séjour dans le pays de résidence a-t-elle une influence sur
la confiance envers la police ?

```{r}
# A passer dans la partie base si ça te va Julien (après l'avoir nettoyée des doubles code rec), à utiliser pour les graphes en dessous
indiv <- indiv %>% 
  mutate(durar2_tous = case_when(group1_rec=="Immigré (né étranger à l'étranger y compris réintégrés)"|group1_rec=="Originaire de l'Outre-mer"~durar2,
                                 TRUE~agenq))

indiv <- indiv %>% 
  mutate(durtotfrm_tous = case_when(group1_rec=="Immigré (né étranger à l'étranger y compris réintégrés)"|group1_rec=="Originaire de l'Outre-mer"~durtotfrm,
                                 TRUE~agenq))
```


```{r}

limit = 50

coloration = c("red","orange","purple","blue","green")
group_un = c("G1_I","G2_I","G1_OM","G2_OM","Autre")

dfinal = data.frame(X=1:limit)

for (i in 1:5){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  g = group_un[i]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g)
  
  X = 1:50
  Y = c()
  for (x in X){
    datax = filter(data,durar2==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol < 3)
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,0)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  dfinal[paste(g,"_","Y",sep="")] = Y
  
  #df = data.frame(X=1:limit,Y=Y,group=g)
  #dfinal = rbind(dfinal,df)  
  
}

plot(X,Y,type="l", xlim = c(0,70), ylim = c(0,1),col=coloration[i])
legend(50,1,legend=c("Immigré","Descendant","Métropole"),col=c("red","orange","green"),lty=c(1,1,1,1,1,1),cex=0.8)
  
dfinal["Durée_de_séjour_en_France"]=dfinal["X"]
dfinal["Proportion_de_confiants_en_la_police"]=dfinal["G1_I_Y"]


```

```{r}
ggplot(dfinal,aes(x =Durée_de_séjour_en_France))+
  geom_point(aes(y = Proportion_de_confiants_en_la_police),color="red", alpha = 0.5)+
  geom_point(aes(y=Autre_Y),color="green", alpha = 0.5)+
  geom_point(aes(y = G2_I_Y),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = G1_I_Y),color="red")+
  geom_smooth(aes(y = G2_I_Y),color="orange")+
  geom_smooth(aes(y=Autre_Y),color="green")+
  ggtitle("Confiance en la police selon la durée de séjour en France")
```



Ici nous remarquons pour les immigrés, une tendance à avoir de moins en
moins confiance en la police selon la durée de séjour : ceci viendrait
confirmer notre hypothèse.

Et en travaillant à âge égal ?

```{r}
limit = 60

coloration = c("red","orange","green","blue")

age_groupe = c("18_29","30_39","40_49","50_59")

l_age_inf = c(18,30,40,50)
l_age_sup = c(29,39,49,59)

df = data.frame(X =X)

for (i in 1:4){ #Pour chaque groupe : traçons une courbe confiance envers la police ~ durée de sejour
  
  age_inf = l_age_inf[i]
  age_sup = l_age_sup[i]
  age_g = age_groupe[i]
  
  g = group_un[1]
  
  #durée de sejour depuis la première arrivée : $durtotfrm
  #durée de sejour depuis la dernière arrivée : $durar2
  
  data = filter(indiv,group1_code == g & indiv$agenq >= age_inf & indiv$agenq <= age_sup)
  
  X = 1:limit
  Y = c()
  stopp = limit
  for (x in X){
    datax = filter(data,durar2==x & data$i_cnfpol_rec != "Refus ou ne sait pas")
    datax_obj = filter(datax,i_cnfpol < 2)
 
    n_tot = sum(datax$poidsi)
    n_obj = sum(datax_obj$poidsi)
    if (n_tot == 0){
      Y = c(Y,NA)
      stopp = min(stopp,x)
    }
    else{
      Y=c(Y,n_obj/n_tot)
    }
  }
  
  
  df[paste("Y_",age_g,sep="")] = Y
  

}



ggplot(df,aes(x =X))+
  geom_point(aes(y = Y_18_29),color="red", alpha = 0.5)+
  geom_smooth(aes(y = Y_18_29),color="red")+
  geom_point(aes(y = Y_30_39),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = Y_30_39),color="orange")+
    geom_point(aes(y = Y_40_49),color="green", alpha = 0.5)+
  geom_smooth(aes(y = Y_40_49),color="green")+
    geom_point(aes(y = Y_50_59),color="blue", alpha = 0.5)+
  geom_smooth(aes(y = Y_50_59),color="blue")
```

```{r}
ggplot(dfinal,aes(x =X))+
  geom_point(aes(y = G1_I_Y),color="red", alpha = 0.5)+
  geom_point(aes(y=Autre_Y),color="green", alpha = 0.5)+
  geom_point(aes(y = G2_I_Y),color="orange", alpha = 0.5)+
  geom_smooth(aes(y = G1_I_Y),color="red")+
  geom_smooth(aes(y = G2_I_Y),color="orange")+
  geom_smooth(aes(y=Autre_Y),color="green")




```


Cette diminution de la confiance envers la police persévère ! (malgré
une légère remontée pour les cinquantenaires arrivé très jeune en
France)

Nous continuons de confirmer notre hypothèse.

Regardons la présence d'immigrés dans le quartier : pas d'effet clair
non plus

```{r}
#présence d'immigrés dans le quartier (l_immi)
#indiv$l_immi
#indiv$l_immi_rec



ggsurvey(indiv_pd, aes(x = as.factor(l_immi_code), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
  geom_bar(stat = "identity")

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_immi_code, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_immi_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


```

Et concernant les relations avec le quartiers : pas d'effet clair

```{r}
#relations dans le quartier (a_rquart) (avec combien de personnes de ton quartier, es-tu ami ?)

#indiv$a_rquart_rec




indiv_pd <- svydesign(ids = indiv$ident, data = indiv, weights = indiv$poidsi)


ggsurvey(indiv_pd, aes(x = as.factor(a_rquart_code), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
  geom_bar(stat = "identity")


tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+a_rquart_code, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = a_rquart_code, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")

```

Concernant la sécu : se sentir en sécurité favorise la confiance (légère
corrélation)

```{r}
#sécurité du quartier(l_quart_secu)





ggsurvey(indiv_pd, aes(x = as.factor(l_quart_secu_rec), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
  geom_bar(stat = "identity")


tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+l_quart_secu_rec, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = l_quart_secu_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


```

Concernant le fait de vivre dans une QPV : il n'apparait pas clair que
cette variable ait un impact sur le niveau de confiance envers la police
des personnes immigrés.

```{r}

#Vivre dans un QPV (qpv_i)

group_qpv = rep("null",dimension[1])


group_qpv[which(indiv$qpv_i == 0 & indiv$group1_code=="G1-I")] = "G1-I out QPV"
group_qpv[which(indiv$qpv_i == 1 & indiv$group1_code=="G1-I")] = "G1-I in QPV"
group_qpv[which(indiv$qpv_i == 0 & indiv$group1_code=="G2-I")] = "G2-I out QPV"
group_qpv[which(indiv$qpv_i == 1 & indiv$group1_code=="G2-I")] = "G2-I in QPV"
group_qpv[which(indiv$qpv_i == 0 & indiv$group1_code=="Autre")] = "Autre out QPV"
group_qpv[which(indiv$qpv_i == 1 & indiv$group1_code=="Autre")] = "Autre in QPV"


indiv["group_QPV"] = group_qpv


ggsurvey(indiv_pd, aes(x = as.factor(group_QPV), y = as.factor(i_cnfpol_rec), fill = as.factor(i_cnfpol_rec)))+
  geom_bar(stat = "identity")

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+group_QPV, indiv_pd[which(indiv_pd$variables$i_cnfpol_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = group_QPV, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")

tb1 <- data.frame(cprop(svytable(~i_cnfpol_rec+qpv_i_rec, indiv_pd[which(indiv_pd$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_cnfpol_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_cnfpol_rec)) +
  geom_bar(stat="identity")


```

## Discriminations

Les variables d'intérêt sont -\> i_contri : fqce des controle par la
police -\> i_controla & i_controlb : en une seule variable i_control_rec
(\_a,\_b,...,\_g,\_flag)

###Faisons une première étude sur la fréquence des controles de police

```{r}

#group_1 :
ggsurvey(indiv_pd, aes(x = as.factor(group1_code), y = as.factor(i_contri_rec), fill = as.factor(i_contri_rec)))+
  geom_bar(stat = "identity")

tb1 <- data.frame(cprop(svytable(~i_contri_rec+group1_code, indiv_pd[which(indiv_pd$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")


```

On remarque les G2 sont plus touchés par les contôles policiers que les
G1 (pour les I et les OM) : ça pourrait être intéressant de regarder
selon l'âge.

Nous pourrions déjà trouver une première explication à notre apparent
paradoxe : les G2 (certainement plus jeunes) sont plus controlés que les
G1 (certainement plus vieux). Ceci ajoute une explication à la
différence G1-G2.

De plus nous remarquons que la case "Autre" (= ni immigrés ni
descendants d'immigrés) sont plus controlé que les G1 par la police.

------------------------------------------------------------------------

Nous pourrions désormais observer si le fait de vivre dans certains
quartier favorisent les controles de police : légère corrélation entre
le nombre de controle subies par personne et le présence d'immigrés dans
le quartier d'habitation.

```{r}
#présence d'immigrés dans le quartier (l_immi)


ggsurvey(indiv_pd, aes(x = as.factor(l_immi_code), y = as.factor(i_contri_rec), fill = as.factor(i_contri_rec)))+
  geom_bar(stat = "identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+l_immi_code, indiv_pd[which(indiv_pd$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = l_immi_code, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")


```

La fréquence des controles de police peut-elle expliquer le sentiment de
sécurité ? Ou bien est-ce le sentiment de sécurité qui pourrait
expliquer la fréquence des controles ? Ou les deux ?

A priori déclarer être dans un quartier où la sécurité est mauvaise
favorise le fait d'être controlé

```{r}
#sécurité du quartier(l_quart_secu)




ggsurvey(indiv_pd, aes(x = as.factor(l_quart_secu_rec), y = as.factor(i_contri_rec), fill = as.factor(i_contri_rec)))+
  geom_bar(stat = "identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+l_quart_secu_rec, indiv_pd[which(indiv_pd$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = l_quart_secu_rec, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")



```

Enfin, est-ce que vivre en QPV est corrélé avec la frequence des
controles de police ?

Nous constatons qu'il y a significativement plus de controle en vivant
en QPV que non. Mais surtout plus de controle en n'étant pas G1 !

En ajoutant la catégorie G2 : on observe que les G2 sont plus controlé
que les Autres qui le sont plus que les G1.

```{r}

#Vivre dans un QPV (qpv_i)



ggsurvey(indiv_pd, aes(x = as.factor(group_QPV), y = as.factor(i_contri_rec), fill = as.factor(i_contri_rec)))+
  geom_bar(stat = "identity")

tb1 <- data.frame(cprop(svytable(~i_contri_rec+group_QPV, indiv_pd[which(indiv_pd$variables$i_contri_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = group_QPV, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")


tb1 <- data.frame(cprop(svytable(~i_contri_rec+qpv_i_rec, indiv_pd[which(indiv_pd$variables$qpv_i_rec != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_contri_rec != "Total")

ggplot(tb2, aes(x = qpv_i_rec, y= Freq, fill = i_contri_rec)) +
  geom_bar(stat="identity")


```

Conclusion quant aux fréquences de controle : les G2 sont plus souvent
controlés que les non-immigrés ni-descendants d'immigrés eux-même plus
controlés que les G1.

### i_control_rec : et concernant le déroulement du controle que se passe-t-il ?

Je pense qu'il faudrait faire des courbes.

```{r}

#group_1 :

tb1 <- data.frame(cprop(svytable(~i_control_rec_a+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_a != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_a != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_a)) +
  geom_bar(stat="identity")+
  ggtitle("Ils vous ont expliqué ce qu'ils faisaient et pourquoi")



```

```{r}
tb1 <- data.frame(cprop(svytable(~i_control_rec_b+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_b != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_b != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_b)) +
  geom_bar(stat="identity")+
  ggtitle("Ils ont été polis")


```

```{r}
tb1 <- data.frame(cprop(svytable(~i_control_rec_c+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_c != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_c != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_c)) +
  geom_bar(stat="identity")+
ggtitle("Ils vous ont tutoyé")
```

```{r}
tb1 <- data.frame(cprop(svytable(~i_control_rec_d+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_d != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_d != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_d)) +
  geom_bar(stat="identity")+
ggtitle("Ils ont fouillé vos vêtements et vos sacs")
```

```{r}
tb1 <- data.frame(cprop(svytable(~i_control_rec_e+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_e != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_e != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_e)) +
  geom_bar(stat="identity")+
ggtitle("Ils vous ont provoqué, insulté")
```

```{r}
tb1 <- data.frame(cprop(svytable(~i_control_rec_f+group1_code, indiv_pd[which(indiv_pd$variables$i_control_rec_f != "Refus ou ne sait pas")])))
tb2 <- filter(tb1,i_control_rec_f != "Total")

ggplot(tb2, aes(x = group1_code, y= Freq, fill = i_control_rec_f)) +
  geom_bar(stat="identity")+
ggtitle("Ils ont été brutaux")
```

## Confiance et discriminations

```{r}


#df = indiv_pd[c("","i_control_rec_e","i_control_rec_f")]


```

### d_lieudisagr_d
```{r}
ggsurvey(indiv_pd) +
  aes(x = i_cnfpol_rec, fill = d_lieudisagr_d_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")

```

```{r}
indiv_immigre= indiv %>% filter(group1_code == "G1_I")
indiv_immig_pd <- svydesign(ids = indiv_immigre$ident, data = indiv_immigre, weights = indiv_immigre$poidsi)

ggsurvey(indiv_immig_pd) +
  aes(x = i_cnfpol_rec, fill = d_lieudisagr_d_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")

```

```{r}
indiv_origine= indiv %>% filter(origine_tous_g2_rec %in% c("Immigres d'Afrique guineenne/centrale", "Immigres d'Afrique sahelienne","Immigres d'autres pays d'Afrique", "Immigres d'Algerie", "Immigres du Maroc/Tunisie" ))
indiv_origine_pd <- svydesign(ids = indiv_origine$ident, data = indiv_origine, weights = indiv_origine$poidsi)

ggsurvey(indiv_origine_pd) +
  aes(x = i_cnfpol_rec, fill = d_lieudisagr_d_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")
```


```{r}
indiv_origine= indiv %>% filter(origine_tous_g2_rec %in% c("Immigres d'autres pays d'Asie", "Immigres d'Asie du Sud-est","Immigres de Chine
"))
indiv_origine_pd <- svydesign(ids = indiv_origine$ident, data = indiv_origine, weights = indiv_origine$poidsi)

ggsurvey(indiv_origine_pd) +
  aes(x = i_cnfpol_rec, fill = d_lieudisagr_d_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")
```



### i_contri_rec
```{r}
ggsurvey(indiv_pd) +
  aes(x = i_cnfpol_rec, fill = i_contri_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")

```

```{r}
indiv_immigre= indiv %>% filter(group1_code == "G1_I")
indiv_immig_pd <- svydesign(ids = indiv_immigre$ident, data = indiv_immigre, weights = indiv_immigre$poidsi)

ggsurvey(indiv_immig_pd) +
  aes(x = i_cnfpol_rec, fill = i_contri_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")

```

```{r}
indiv_origine= indiv %>% filter(origine_tous_g2_rec %in% c("Immigres d'Afrique guineenne/centrale", "Immigres d'Afrique sahelienne","Immigres d'autres pays d'Afrique", "Immigres d'Algerie", "Immigres du Maroc/Tunisie" ))
indiv_origine_pd <- svydesign(ids = indiv_origine$ident, data = indiv_origine, weights = indiv_origine$poidsi)

ggsurvey(indiv_origine_pd) +
  aes(x = i_cnfpol_rec, fill = i_contri_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")
```


```{r}
indiv_origine= indiv %>% filter(origine_tous_g2_rec %in% c("Immigres d'autres pays d'Asie", "Immigres d'Asie du Sud-est","Immigres de Chine
"))
indiv_origine_pd <- svydesign(ids = indiv_origine$ident, data = indiv_origine, weights = indiv_origine$poidsi)

ggsurvey(indiv_origine_pd) +
  aes(x = i_cnfpol_rec, fill = i_contri_rec) +
  geom_bar(position = "fill") +
  scale_fill_hue(direction = 1) +
  theme_minimal()+
  theme(legend.position = "bottom")
```

# Qui sont les personnes très discriminées?
```{r}
indiv_discri <- indiv %>% filter(d_lieudisagr_d_rec=="Discrimination lors d'un contrôle de police")
indiv_discri_pd <- svydesign(ids = indiv_discri$ident, data = indiv_discri, weights = indiv_discri$poidsi)

```

```{r}
indiv <- indiv %>% 
  mutate(compor_discri = case_when(i_controla_a == 0 |i_controlb_d == 0|i_controla_f ==0|i_controlb_b == 0 ~ "Discrimination dans le comportement de la police par le négatif",
        i_controla_b == 1 | i_controla_c ==1 | i_controla_d == 1 | i_controla_e ==1 | i_controlb_a ==1 | i_controlb_c == 1 | i_controlb_e ==1 | i_controlb_f==1 ~ "Discrimination dans le comportement de la police par le positif",
        i_controlagr_flag %in% c(-1, -2) ~ "Refus ou ne sait pas",
        i_controlagr_flag == 0 ~ "Pas de contrôle de police",
                                   TRUE ~ "Pas de comportement discriminatoire lors du dernier contrôle"))
indiv_pd <- svydesign(ids = indiv$ident, data = indiv, weights = indiv$poidsi)
cprop(svytable(~compor_discri+origine_tous_g2_rec, indiv_pd))
```

```{r}
ggsurvey(indiv_pd) +
 aes(x = i_cnfpol_rec, fill = compor_discri) +
 geom_bar(position = "fill") +
 scale_fill_hue(direction = 1) +
 theme_minimal()

ggsurvey(indiv_pd) +
 aes(x = origine_tous_g2_rec, fill = compor_discri) +
 geom_bar(position = "fill") +
 scale_fill_hue(direction = 1) +
 coord_flip() +
 theme_minimal()
```
Même stats desc seulement pour ceux qui ont eu un contrôle de police :

```{r}

indiv_contr <- indiv %>% filter(compor_discri %in% c("Discrimination dans le comportement de la police par le négatif", "Discrimination dans le comportement de la police par le positif", "Pas de comportement discriminatoire lors du dernier contrôle"))
indiv_contr_pd <- svydesign(ids = indiv_contr$ident, data = indiv_contr, weights = indiv_contr$poidsi)

ggsurvey(indiv_contr_pd) +
 aes(x = i_cnfpol_rec, fill = compor_discri) +
 geom_bar(position = "fill") +
 scale_fill_hue(direction = 1) +
 theme_minimal()

ggsurvey(indiv_contr_pd) +
 aes(x = origine_tous_g2_rec, fill = compor_discri) +
 geom_bar(position = "fill") +
 scale_fill_hue(direction = 1) +
 coord_flip() +
 theme_minimal()
```


