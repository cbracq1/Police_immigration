---
title: "ACM et Arbre de décision"
author: "Bracq, Raymond"
date: "28/11/2023"
output:
  html_notebook: 
    encoding: UTF-8
  pdf_document: default
  html_document:
    df_print: paged
    encoding: UTF-8
editor_options:
  markdown:
    wrap: 72
---

# Projet DSSS : Police et immigration {.tabset .tabset-fade}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include = FALSE}
library(haven)
library(tidyverse)
library(dplyr)
library(labelled)
library(survey)
library(arrow)
library(ggplot2)
library(questionr)
#install.packages("rpart") #pour l'arbre de décision
library(rpart)
#install.packages("rpart.plot")
library(rpart.plot)
library(forcats)
```

```{r base, include = FALSE}
source("Base.R")
```


# Un Arbre de décision : pour construire un arbre de décision nous commencerons par identifier des features et des labels. En particulier, nous cherchons à expliquer la confiance en la police (le label) en fonction des features suivantes :
- l'age (agenq)
- la durée de séjour en France métropolitaine (durar2)
- le pays de naissance
- le fait d'être descendant d'immigré
- la frequence de controle policier
- le sentiment de sécurité
- la présence d'immigré dans le quartier
- le fait de vivre dans un QPV

Voir si on ne remet pas les modalités en chiffre ici.

Nous allons a minima transformer notre label en variable binaire = 1(i_cnfpol_rec = Tout à fait)


```{r base, include = FALSE}

indiv["i_cnfpol_1"] = (indiv$i_cnfpol == 1)*1

#data = select(indiv,c(i_cnfpol_1,agenq, durar2, group1_code,origine_tous_g2_cont,i_contri_rec,l_quart_secu_rec,l_immi_code,qpv_i,a_rquart_code))
data = select(indiv,c(i_cnfpol_1,agenq, durar2,i_contri_rec,l_quart_secu_rec,l_immi_code,qpv_i,a_rquart_code))



fit <- rpart(i_cnfpol_1~., data = data, method = 'anova')
rpart.plot(fit, type = 2, extra = 1)


prp(fit,extra=1)


```


```{r base, include = FALSE}

indiv <- indiv %>% 
  mutate(compor_discri = case_when(i_controla_a == 0 |i_controlb_d == 0|i_controla_f ==0|i_controlb_b == 0 ~ "Discrimination dans le comportement de la police par le négatif",
        i_controla_b == 1 | i_controla_c ==1 | i_controla_d == 1 | i_controla_e ==1 | i_controlb_a ==1 | i_controlb_c == 1 | i_controlb_e ==1 | i_controlb_f==1 ~ "Discrimination dans le comportement de la police par le positif",
        i_controlagr_flag %in% c(-1, -2) ~ "Refus ou ne sait pas",
        i_controlagr_flag == 0 ~ "Pas de contrôle de police",
                                   TRUE ~ "Pas de comportement discriminatoire lors du dernier contrôle"))


write_parquet(indiv,'C:/Users/3e3gr/OneDrive/Bureau/indiv.parquet')

```








